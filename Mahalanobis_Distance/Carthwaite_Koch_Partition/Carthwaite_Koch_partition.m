Background_Data=[214.8	131	131.1	9	9.7	141
214.6	129.7	129.7	8.1	9.5	141.7
214.8	129.7	129.7	8.7	9.6	142.2
214.8	129.7	129.6	7.5	10.4	142
215	129.6	129.7	10.4	7.7	141.8
215.7	130.8	130.5	9	10.1	141.4
215.5	129.5	129.7	7.9	9.6	141.6
214.5	129.6	129.2	7.2	10.7	141.7
214.9	129.4	129.7	8.2	11	141.9
215.2	130.4	130.3	9.2	10	140.7
215.3	130.4	130.3	7.9	11.7	141.8
215.1	129.5	129.6	7.7	10.5	142.2
215.2	130.8	129.6	7.9	10.8	141.4
214.7	129.7	129.7	7.7	10.9	141.7
215.1	129.9	129.7	7.7	10.8	141.8
214.5	129.8	129.8	9.3	8.5	141.6
214.6	129.9	130.1	8.2	9.8	141.7
215	129.9	129.7	9	9	141.9
215.2	129.6	129.6	7.4	11.5	141.5
214.7	130.2	129.9	8.6	10	141.9
215	129.9	129.3	8.4	10	141.4
215.6	130.5	130	8.1	10.3	141.6
215.3	130.6	130	8.4	10.8	141.5
215.7	130.2	130	8.7	10	141.6
215.1	129.7	129.9	7.4	10.8	141.1
215.3	130.4	130.4	8	11	142.3
215.5	130.2	130.1	8.9	9.8	142.4
215.1	130.3	130.3	9.8	9.5	141.9
215.1	130	130	7.4	10.5	141.8
214.8	129.7	129.3	8.3	9	142
215.2	130.1	129.8	7.9	10.7	141.8
214.8	129.7	129.7	8.6	9.1	142.3
215	130	129.6	7.7	10.5	140.7
215.6	130.4	130.1	8.4	10.3	141
215.9	130.4	130	8.9	10.6	141.4
214.6	130.2	130.2	9.4	9.7	141.8
215.5	130.3	130	8.4	9.7	141.8
215.3	129.9	129.4	7.9	10	142
215.3	130.3	130.1	8.5	9.3	142.1
213.9	130.3	129	8.1	9.7	141.3
214.4	129.8	129.2	8.9	9.4	142.3
214.8	130.1	129.6	8.8	9.9	140.9
214.9	129.6	129.4	9.3	9	141.7
214.9	130.4	129.7	9	9.8	140.9
214.8	129.4	129.1	8.2	10.2	141
214.3	129.5	129.4	8.3	10.2	141.8
214.8	129.9	129.7	8.3	10.2	141.5
214.8	129.9	129.7	7.3	10.9	142
214.6	129.7	129.8	7.9	10.3	141.1
214.5	129	129.6	7.8	9.8	142
214.6	129.8	129.4	7.2	10	141.3
215.3	130.6	130	9.5	9.7	141.1
214.5	130.1	130	7.8	10.9	140.9
215.4	130.2	130.2	7.6	10.9	141.6
214.5	129.4	129.5	7.9	10	141.4
215.2	129.7	129.4	9.2	9.4	142
215.7	130	129.4	9.2	10.4	141.2
215	129.6	129.4	8.8	9	141.1
215.1	130.1	129.9	7.9	11	141.3
215.1	130	129.8	8.2	10.3	141.4
215.1	129.6	129.3	8.3	9.9	141.6
215.3	129.7	129.4	7.5	10.5	141.5
215.4	129.8	129.4	8	10.6	141.5
214.5	130	129.5	8	10.8	141.4
215	130	129.8	8.6	10.6	141.5
215.2	130.6	130	8.8	10.6	140.8
214.6	129.5	129.2	7.7	10.3	141.3
214.8	129.7	129.3	9.1	9.5	141.5
215.1	129.6	129.8	8.6	9.8	141.8
214.9	130.2	130.2	8	11.2	139.6
213.8	129.8	129.5	8.4	11.1	140.9
215.2	129.9	129.5	8.2	10.3	141.4
215	129.6	130.2	8.7	10	141.2
214.4	129.9	129.6	7.5	10.5	141.8
215.2	129.9	129.7	7.2	10.6	142.1
214.1	129.6	129.3	7.6	10.7	141.7
214.9	129.9	130.1	8.8	10	141.2
214.6	129.8	129.4	7.4	10.6	141
215.2	130.5	129.8	7.9	10.9	140.9
214.6	129.9	129.4	7.9	10	141.8
215.1	129.7	129.7	8.6	10.3	140.6
214.9	129.8	129.6	7.5	10.3	141
215.2	129.7	129.1	9	9.7	141.9
215.2	130.1	129.9	7.9	10.8	141.3
215.4	130.7	130.2	9	11.1	141.2
215.1	129.9	129.6	8.9	10.2	141.5
215.2	129.9	129.7	8.7	9.5	141.6
215	129.6	129.2	8.4	10.2	142.1
214.9	130.3	129.9	7.4	11.2	141.5
215	129.9	129.7	8	10.5	142
214.7	129.7	129.3	8.6	9.6	141.6
215.4	130	129.9	8.5	9.7	141.4
214.9	129.4	129.5	8.2	9.9	141.5
214.5	129.5	129.3	7.4	10.7	141.5
214.7	129.6	129.5	8.3	10	142
215.6	129.9	129.9	9	9.5	141.7
215	130.4	130.3	9.1	10.2	141.1
214.4	129.7	129.5	8	10.3	141.2
215.1	130	129.8	9.1	10.2	141.5
214.7   130     129.4   7.8     10      141.2];

Test_Data=[215.8   129.7   129.0   6.9      8.6    143.2
214.4	130.1	130.3	9.7	11.7	139.8
214.9	130.5	130.2	11	11.5	139.5
214.9	130.3	130.1	8.7	11.7	140.2
215	130.4	130.6	9.9	10.9	140.3
214.7	130.2	130.3	11.8	10.9	139.7
214.8	129.7	129.7	8.7	9.6	142.2
214.8	129.7	129.6	7.5	10.4	142
215	129.6	129.7	10.4	7.7	141.8];


meanA=mean(Background_Data);
SampVar=cov(Background_Data);
InvVarA=inv(SampVar);

% Start that part of the Garthwaite-Koch partition that is the same for all items 

Dmat = diag(1./sqrt(diag(SampVar)));
DSD=Dmat*SampVar*Dmat;

[eigvec,eigval]=eig(DSD);
InvRootEig=1./sqrt(diag(eigval));

InvDSDhalf=eigvec*diag(InvRootEig)*eigvec'


for k=1:size(Test_Data,1)
	ItemVal=Test_Data(k,:);
	diff=meanA-ItemVal;

	Qform=diff*InvVarA*diff'
	Tsquare=Qform(1,1);
	fprintf('The Mahalanobis distance is: %f\n',Tsquare);

	W=InvDSDhalf*Dmat*diff';
	GKcontrib = diag(W*W');
	Percentage = 100*GKcontrib./sum(GKcontrib)
	Correlation = diag(inv(InvDSDhalf));
end
